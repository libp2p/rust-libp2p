name: Continuous integration

on:
  pull_request:
  push:
    branches:
      - master

jobs:
  test-desktop:
    name: Build and test
    runs-on: ubuntu-latest
    steps:

    - name: Cancel Previous Runs
      uses: styfle/cancel-workflow-action@0.9.0
      with:
        access_token: ${{ github.token }}

    - uses: actions/checkout@v2.3.4

    - name: Cache CARGO_HOME
      uses: actions/cache@v2.1.6
      with:
        path: ~/.cargo
        key: cargo-home-${{ hashFiles('Cargo.toml') }}

    - name: Cache cargo build
      uses: actions/cache@v2.1.6
      with:
        path: target
        key: cargo-build-target-${{ hashFiles('Cargo.toml') }}

    - name: Run tests, with all features
      run: while cargo test --all-features --package libp2p-relay -- --nocapture; do :; done
      env:
          RUST_LOG: debug
